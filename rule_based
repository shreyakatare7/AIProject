import pandas as pd

# load csv file 
df = pd.read_csv('lung cancer survey.csv')

# handling missing values 
df.fillna({"SMOKING": 1, "YELLOW_FINGERS": 1, "ANXIETY": 1, "PEER_PRESSURE": 1, 
           "CHRONIC DISEASE": 1, "FATIGUE": 1, "ALLERGY": 1, "WHEEZING": 1, 
           "ALCOHOL CONSUMING": 1, "COUGHING": 1, "SHORTNESS OF BREATH": 1, 
           "SWALLOWING DIFFICULTY": 1, "CHEST PAIN": 1, "LUNG CANCER": "NO"}, inplace=True)

df.columns = df.columns.str.strip()
# converting rows of dataset into facts 
def process_row_to_facts(row):
    return {
        "SMOKING": row["SMOKING"],
        "YELLOW_FINGERS": row["YELLOW_FINGERS"],
        "ANXIETY": row["ANXIETY"],
        "PEER_PRESSURE": row["PEER_PRESSURE"],
        "CHRONIC_DISEASE": row["CHRONIC DISEASE"],
        "FATIGUE": row["FATIGUE"],
        "ALLERGY": row["ALLERGY"],
        "WHEEZING": row["WHEEZING"],
        "ALCOHOL_CONSUMING": row["ALCOHOL CONSUMING"],
        "COUGHING": row["COUGHING"],
        "SHORTNESS_BREATH": row["SHORTNESS OF BREATH"],
        "SWALLOWING_DIFFICULTY": row["SWALLOWING DIFFICULTY"],
        "CHEST_PAIN": row["CHEST PAIN"],
        "LUNG_CANCER": row["LUNG_CANCER"]
    }

# convert the entire dataset into facts
facts_list = [process_row_to_facts(row) for index, row in df.iterrows()]

# define the rule-based system
class RuleBasedSystem:
    def __init__(self):
        self.rules = []

    def add_rule(self, condition, action):
        # adds a new rule (condition, action) to the system
        self.rules.append((condition, action))

    def evaluate(self, facts):
        # evaluates the facts against the rules and triggers the appropriate diagnosis
        for condition, action in self.rules:
            if condition(facts):
                return action(facts)
        return "No diagnosis made"

# action functions
def diagnose_lung_cancer(facts):
    return "Lung Cancer Diagnosed"

def diagnose_no_cancer(facts):
    return "No Lung Cancer"

# rule conditions
def rule_lung_cancer(facts):
    # triggers when certain symptoms are present
    return (facts["SMOKING"] == 2 and (facts["COUGHING"] == 2 or facts["CHEST_PAIN"] == 2) and
            facts["WHEEZING"] == 2)

def rule_no_lung_cancer(facts):
    # triggers when symptoms are mild
    return (facts["SMOKING"] == 1 and facts["COUGHING"] == 1 and 
            facts["CHEST_PAIN"] == 1 and facts["WHEEZING"] == 1)

def rule_ambiguous(facts):
    # triggers when symptoms are mixed or ambiguous
    return (facts["SMOKING"] == 2 and facts["COUGHING"] == 1 and
            facts["CHEST_PAIN"] == 1 and facts["SHORTNESS_BREATH"] == 2)

# create the rule-based system
system = RuleBasedSystem()

# add rules
system.add_rule(rule_lung_cancer, diagnose_lung_cancer)
system.add_rule(rule_no_lung_cancer, diagnose_no_cancer)
system.add_rule(rule_ambiguous, lambda facts: "No diagnosis made")

# apply the rules to each row in the dataset
results = []
deep_learning_cases = [] # collect cases with "No diagosis made" for deep learning
correct_predictions = 0
total_predictions = 0

for index, row in df.iterrows():
    facts = process_row_to_facts(row)
    diagnosis = system.evaluate(facts)
    
    # if no diagnosis is made, flag for deep learning
    if diagnosis == "No diagnosis made":
        deep_learning_cases.append(index)  # collect cases for deep learning
    else:
        # compare the diagnosis with actual lung cancer result
        actual = row["LUNG_CANCER"]
        if (diagnosis == "Lung Cancer Diagnosed" and actual == "YES") or \
           (diagnosis == "No Lung Cancer" and actual == "NO"):
            correct_predictions += 1
        total_predictions += 1
    
    results.append(diagnosis)

# output the diagnosis results
df["DIAGNOSIS_RESULT"] = results
print(df[["SMOKING", "YELLOW_FINGERS", "ANXIETY", "PEER_PRESSURE", "CHRONIC DISEASE", "FATIGUE", "ALLERGY",
          "WHEEZING", "ALCOHOL CONSUMING", "COUGHING", "SHORTNESS OF BREATH", "SWALLOWING DIFFICULTY", 
          "CHEST PAIN", "DIAGNOSIS_RESULT"]])

# calculate accuracy
if total_predictions > 0:
    accuracy = correct_predictions / total_predictions
    print(f"Accuracy: {accuracy:.2%}")
else:
    print("No cases diagnosed to calculate accuracy.")

# print cases that need deep learning for further analysis
print(f"Cases sent to deep learning: {deep_learning_cases}")
